<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Imposter Party</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <main class="mx-auto flex min-h-screen max-w-3xl flex-col gap-8 px-4 py-10">
      <header
        class="rounded-3xl bg-slate-900/70 p-6 shadow-2xl shadow-indigo-500/10"
      >
        <p class="text-sm uppercase tracking-[0.3em] text-indigo-300">
          Partyspiel
        </p>
        <h1 class="mt-3 text-3xl font-semibold text-white">Imposter</h1>
        <p class="mt-2 text-slate-300">
          Füge 3-5 Spieler:innen hinzu, starte eine Runde und gib das Gerät in
          der angezeigten Reihenfolge weiter. Eine Person bekommt den geheimen
          Begriff, eine Person die Rolle als Impostor. Nach der Ausgabe beginnt
          ihr mit Fragen und versucht, die Täuschung aufzudecken.
        </p>
      </header>

      <section
        id="setup-section"
        class="rounded-3xl bg-slate-900/60 p-6 shadow-xl shadow-black/40"
      >
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-xl font-semibold">1. Namen vorbereiten</h2>
          <p id="player-count" class="text-sm text-slate-400">0/5</p>
        </div>
        <form
          id="player-form"
          class="mt-5 flex flex-col gap-4"
          autocomplete="off"
        >
          <div class="flex flex-col gap-3 sm:flex-row">
            <label class="sr-only" for="player-name">Spielername</label>
            <input
              id="player-name"
              name="player-name"
              type="text"
              maxlength="16"
              placeholder="Name eingeben"
              class="flex-1 rounded-2xl border border-slate-700 bg-slate-900/80 px-4 py-3 text-base font-medium focus:border-indigo-400 focus:outline-none"
              required
            />
            <button
              id="add-player"
              type="submit"
              class="rounded-2xl bg-indigo-500 px-6 py-3 text-base font-semibold text-white transition hover:bg-indigo-400"
            >
              Hinzufügen
            </button>
          </div>
          <p id="player-feedback" class="text-sm text-slate-400">
            Mindestens 3, maximal 5 Personen.
          </p>
        </form>
        <ul id="player-list" class="mt-4 flex flex-wrap gap-2"></ul>
        <div class="mt-6 flex flex-wrap gap-3">
          <button
            id="start-game"
            type="button"
            class="flex-1 rounded-2xl bg-emerald-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-emerald-400 disabled:cursor-not-allowed disabled:bg-emerald-800/60"
          >
            Runde starten
          </button>
          <button
            id="reset-players"
            type="button"
            class="rounded-2xl border border-slate-700 px-4 py-3 text-base font-semibold text-slate-200 transition hover:bg-slate-800"
          >
            Namen zurücksetzen
          </button>
        </div>
      </section>

      <section
        id="round-section"
        class="hidden rounded-3xl bg-slate-900/60 p-6 shadow-xl shadow-black/40"
      >
        <div
          class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"
        >
          <h2 class="text-xl font-semibold">2. Runde spielen</h2>
          <p
            id="progress-indicator"
            class="hidden rounded-full bg-slate-800 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-indigo-200"
          ></p>
        </div>
        <p id="status-title" class="mt-2 text-lg font-medium text-slate-200">
          Noch keine Runde aktiv.
        </p>
        <p id="status-subtitle" class="text-sm text-slate-400">
          Sobald du startest, erscheint hier die Reihenfolge.
        </p>
        <p
          id="order-note"
          class="mt-2 hidden text-xs uppercase tracking-[0.3em] text-slate-500"
        >
          Zufällige Reihenfolge pro Runde
        </p>

        <div
          id="reveal-card"
          class="mt-6 rounded-3xl border border-slate-800 bg-slate-950/60 p-6 text-center shadow-inner shadow-black/40"
        >
          <p
            id="reveal-label"
            class="text-sm uppercase tracking-[0.4em] text-slate-500"
          >
            Bereit?
          </p>
          <p id="reveal-text" class="mt-3 text-3xl font-semibold text-white">
            Tippe auf "Anzeigen".
          </p>
          <p id="reveal-hint" class="mt-2 text-sm text-slate-400">
            Nur die aktuelle Person darf schauen.
          </p>
        </div>

        <div class="mt-6 flex flex-wrap gap-3">
          <button
            id="show-card"
            type="button"
            class="flex-1 rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400 disabled:cursor-not-allowed disabled:bg-indigo-900/70"
          >
            Anzeigen
          </button>
          <button
            id="next-player"
            type="button"
            class="flex-1 rounded-2xl bg-slate-800 px-4 py-3 text-base font-semibold text-white transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:bg-slate-900/60"
          >
            Verstecken & Weitergeben
          </button>
          <button
            id="restart-round"
            type="button"
            class="rounded-2xl border border-slate-700 px-4 py-3 text-base font-semibold text-slate-200 transition hover:bg-slate-800"
          >
            Neue Runde
          </button>
        </div>
      </section>

      <footer class="pb-6 text-center text-xs text-slate-500">
        Lokal laufendes Partyspiel &middot; Alle Daten bleiben im Browser.
      </footer>
    </main>

    <script>
      (() => {
        const storageKey = "imposter-game-players";
        const germanWords = [
          {
            word: "Kaffeemaschine",
            hint: "Beliebtes Bürogerät für den dringend benötigten Koffein-Schub.",
          },
          {
            word: "Gartenstuhl",
            hint: "Steht meist im Sommer draußen und lädt zum Zurücklehnen ein.",
          },
          {
            word: "Regenschirm",
            hint: "Hilft dir, trocken zu bleiben, wenn der Himmel schlechte Laune hat.",
          },
          {
            word: "Kletterhalle",
            hint: "Hier sichert man sich gegenseitig und schaut hoch hinaus.",
          },
          { word: "Vulkan", hint: "Ein Berg, der manchmal Feuer speit." },
          {
            word: "Schallplatte",
            hint: "Dreht sich gemütlich im Kreis und bringt warmen Vinyl-Klang.",
          },
          { word: "Seifenspender", hint: "Drücken, reinigen, fertig." },
          {
            word: "Bauernmarkt",
            hint: "Hier duftet es nach frischem Brot und Kräutern.",
          },
          {
            word: "Laternenfest",
            hint: "Lichtermeer in der Nacht, besonders im Herbst beliebt.",
          },
          {
            word: "Fahrradhelm",
            hint: "Schützt den Kopf, wenn du auf zwei Rädern unterwegs bist.",
          },
          {
            word: "Picknickkorb",
            hint: "Randvoll mit Snacks für einen Nachmittag im Park.",
          },
          {
            word: "Sternwarte",
            hint: "Hier schaut man nicht direkt, sondern durch große Teleskope.",
          },
          {
            word: "Eislaufbahn",
            hint: "Glatt, kalt und perfekt für Pirouetten.",
          },
          {
            word: "Schlittenhunde",
            hint: "Dieses Team zieht dich durch verschneite Landschaften.",
          },
          {
            word: "Waldorchester",
            hint: "Viele Instrumente, ein gemeinsamer Klang im Grünen.",
          },
          {
            word: "Kochkurs",
            hint: "Hier schnippelt man gemeinsam und lernt neue Rezepte.",
          },
          {
            word: "Schneekugel",
            hint: "Shake it! Danach tanzen Flocken um eine kleine Welt.",
          },
          {
            word: "Gewächshaus",
            hint: "Hier herrscht immer Frühling, egal welches Wetter draußen wartet.",
          },
          {
            word: "Puzzleabend",
            hint: "Ein Tisch voller Teile, Geduld und Teamwork.",
          },
          {
            word: "Konzertticket",
            hint: "Das Eintritts-Band in eine laute Nacht.",
          },

          // Neue zufällige (und teils freche) Ergänzungen
          {
            word: "Biergarten",
            hint: "Sonnenschein, Maßkrüge und zünftige Brotzeit.",
          },
          {
            word: "Wärmflasche",
            hint: "Dein kuscheliger Bettgefährte an kalten Nächten.",
          },
          { word: "Kondomautomat", hint: "24/7 bereit, wenn’s spontan wird." },
          {
            word: "Glühweinstand",
            hint: "Heiß, süß und perfekt für frostige Weihnachtsmärkte.",
          },
          {
            word: "Nacktbadestrand",
            hint: "Hier lässt man alles fallen – außer die Sonnencreme.",
          },
          {
            word: "Kuscheldecke",
            hint: "Weich, warm und ideal für Netflix-Marathons.",
          },
          {
            word: "Sexspielzeug",
            hint: "Für solo oder zu zweit – die Spielregeln bestimmst du.",
          },
          {
            word: "Wanderstock",
            hint: "Dein treuer Begleiter auf steilen Pfaden.",
          },
          {
            word: "Stripclub",
            hint: "Licht aus, Spot an – und die Kleidung wird weniger.",
          },
          {
            word: "Kaminfeuer",
            hint: "Knistert romantisch und wärmt von innen wie außen.",
          },
          {
            word: "Lederhose",
            hint: "Traditionell, eng und ein echter Hingucker auf dem Oktoberfest.",
          },
          {
            word: "Massageöl",
            hint: "Gleitfreudig und duftend – für entspannte Stunden.",
          },
          {
            word: "Karaokemaschine",
            hint: "Hier wird jeder zum Star, egal wie falsch gesungen.",
          },
          {
            word: "Fesselspiel",
            hint: "Seile, Handschellen und viel Vertrauen.",
          },
          {
            word: "Zuckerwatte",
            hint: "Rosa Wolke, die auf der Zunge zergeht.",
          },
          {
            word: "Pornokino",
            hint: "Dunkel, anonym und mit Popcorn (manchmal).",
          },
          {
            word: "Hängematte",
            hint: "Schweben zwischen zwei Bäumen und die Welt vergessen.",
          },
          {
            word: "Vibrator",
            hint: "Summt zuverlässig und kennt keine Müdigkeit.",
          },
          {
            word: "Lagerfeuer",
            hint: "Stockbrot, Gitarre und Geschichten bis Mitternacht.",
          },
          {
            word: "Peepshow",
            hint: "Ein Euro, ein Vorhang, ein kurzer Blick.",
          },
        ];

        const state = {
          players: [],
          order: [],
          currentIndex: -1,
          imposter: null,
          word: null,
          revealed: false,
          active: false,
          phase: "setup",
        };

        const el = {
          form: document.getElementById("player-form"),
          playerInput: document.getElementById("player-name"),
          addPlayer: document.getElementById("add-player"),
          playerList: document.getElementById("player-list"),
          playerFeedback: document.getElementById("player-feedback"),
          playerCount: document.getElementById("player-count"),
          startGame: document.getElementById("start-game"),
          resetPlayers: document.getElementById("reset-players"),
          statusTitle: document.getElementById("status-title"),
          statusSubtitle: document.getElementById("status-subtitle"),
          revealCard: document.getElementById("reveal-card"),
          revealLabel: document.getElementById("reveal-label"),
          revealText: document.getElementById("reveal-text"),
          revealHint: document.getElementById("reveal-hint"),
          showCard: document.getElementById("show-card"),
          nextPlayer: document.getElementById("next-player"),
          restartRound: document.getElementById("restart-round"),
          setupSection: document.getElementById("setup-section"),
          roundSection: document.getElementById("round-section"),
          progressIndicator: document.getElementById("progress-indicator"),
          orderNote: document.getElementById("order-note"),
        };

        const safeLocalStorage = {
          get() {
            try {
              const saved = localStorage.getItem(storageKey);
              return saved ? JSON.parse(saved) : [];
            } catch (error) {
              console.warn("LocalStorage nicht verfügbar", error);
              return [];
            }
          },
          set(value) {
            try {
              localStorage.setItem(storageKey, JSON.stringify(value));
            } catch (error) {
              console.warn("Konnte Spieler nicht speichern", error);
            }
          },
        };

        function init() {
          state.players = safeLocalStorage.get();
          resetRoundState();
          renderPlayers();
          bindEvents();
          updateControls();
        }

        function bindEvents() {
          el.form.addEventListener("submit", (event) => {
            event.preventDefault();
            handleAddPlayer();
          });

          el.playerInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
              event.preventDefault();
              handleAddPlayer();
            }
          });

          el.playerList.addEventListener("click", (event) => {
            const target = event.target;
            if (target instanceof HTMLElement && target.dataset.remove) {
              removePlayer(target.dataset.remove);
            }
          });

          el.startGame.addEventListener("click", startRound);
          el.resetPlayers.addEventListener("click", resetPlayers);
          el.showCard.addEventListener("click", revealSecret);
          el.nextPlayer.addEventListener("click", advancePlayer);
          el.restartRound.addEventListener("click", startRound);
        }

        function handleAddPlayer() {
          const rawName = el.playerInput.value.trim();
          if (!rawName) {
            setFeedback("Bitte einen Namen eingeben.");
            return;
          }

          if (state.players.length >= 5) {
            setFeedback("Maximal 5 Spieler:innen erlaubt.");
            el.playerInput.value = "";
            return;
          }

          const normalized = rawName.replace(/\s+/g, " ");
          const duplicate = state.players.some(
            (name) => name.toLowerCase() === normalized.toLowerCase()
          );
          if (duplicate) {
            setFeedback(`${normalized} wurde bereits hinzugefügt.`);
            el.playerInput.value = "";
            return;
          }

          state.players = [...state.players, normalized];
          safeLocalStorage.set(state.players);
          el.playerInput.value = "";
          renderPlayers();
        }

        function removePlayer(name) {
          state.players = state.players.filter((player) => player !== name);
          safeLocalStorage.set(state.players);
          renderPlayers();
        }

        function resetPlayers() {
          state.players = [];
          safeLocalStorage.set(state.players);
          resetRoundState();
          renderPlayers();
        }

        function renderPlayers() {
          el.playerList.innerHTML = "";
          state.players.forEach((name) => {
            const listItem = document.createElement("li");
            listItem.className =
              "flex items-center gap-2 rounded-2xl bg-slate-800 px-4 py-2 text-sm font-medium";
            listItem.innerHTML = `<span>${name}</span><button type="button" aria-label="${name} entfernen" class="text-slate-400 transition hover:text-red-400" data-remove="${name}">&times;</button>`;
            el.playerList.appendChild(listItem);
          });
          el.playerCount.textContent = `${state.players.length}/5`;
          setFeedback(
            state.players.length < 3
              ? "Mindestens 3 Spieler:innen notwendig."
              : "Bereit für eine neue Runde!",
            state.players.length >= 3
          );
          updateControls();
        }

        function setFeedback(message, positive = false) {
          el.playerFeedback.textContent = message;
          el.playerFeedback.className = positive
            ? "text-sm text-emerald-300"
            : "text-sm text-slate-400";
        }

        function secureRandomIndex(maxExclusive) {
          if (maxExclusive <= 0) return 0;
          const cryptoSource = globalThis.crypto;
          if (cryptoSource?.getRandomValues) {
            const buffer = new Uint32Array(1);
            cryptoSource.getRandomValues(buffer);
            return Math.floor((buffer[0] / (0xffffffff + 1)) * maxExclusive);
          }
          return Math.floor(Math.random() * maxExclusive);
        }

        function randomItem(collection) {
          if (!collection.length) return null;
          return collection[secureRandomIndex(collection.length)];
        }

        function shuffle(array) {
          const clone = [...array];
          for (let i = clone.length - 1; i > 0; i--) {
            const j = secureRandomIndex(i + 1);
            [clone[i], clone[j]] = [clone[j], clone[i]];
          }
          return clone;
        }

        function startRound() {
          if (state.players.length < 3) {
            setFeedback("Du brauchst mindestens 3 Namen.");
            return;
          }

          state.order = shuffle(state.players);
          state.currentIndex = 0;
          state.imposter = randomItem(state.order);
          state.word = randomItem(germanWords) ?? germanWords[0];
          state.revealed = false;
          state.active = true;
          state.phase = "show";

          setStatus(
            `Gib an ${state.order[0]}`,
            'Nur diese Person darf jetzt auf "Anzeigen" tippen.'
          );
          hideCard();
          updateControls();
        }

        function revealSecret() {
          if (!state.active || state.currentIndex === -1) return;
          const currentPlayer = state.order[state.currentIndex];
          const isImposter = currentPlayer === state.imposter;

          state.revealed = true;
          state.phase = "reveal";
          el.revealLabel.textContent = isImposter
            ? "Rolle"
            : "Geheimer Begriff";
          el.revealLabel.className = isImposter
            ? "text-sm uppercase tracking-[0.4em] text-rose-300"
            : "text-sm uppercase tracking-[0.4em] text-emerald-300";
          el.revealText.textContent = isImposter
            ? "Du bist der Impostor!"
            : state.word.word;
          el.revealHint.textContent = isImposter
            ? "Erfinde Antworten, ohne aufzufliegen. Stelle Rückfragen und halte dich unauffällig!"
            : `Erkläre den Begriff umsichtig. Hinweis: ${state.word.hint}`;
          updateControls();
        }

        function advancePlayer() {
          if (!state.active || !state.revealed) return;

          state.revealed = false;
          state.currentIndex += 1;

          if (state.currentIndex >= state.order.length) {
            finishRound();
            return;
          }

          state.phase = "show";
          setStatus(
            `Gib an ${state.order[state.currentIndex]}`,
            'Gerät weiterreichen und erst dann auf "Anzeigen" tippen.'
          );
          hideCard();
          updateControls();
        }

        function finishRound() {
          state.active = false;
          state.currentIndex = -1;
          state.order = [];
          state.phase = "discussion";
          setStatus(
            "Alle Karten verteilt!",
            "Ihr könnt jetzt diskutieren und den Impostor entlarven."
          );
          el.revealLabel.textContent = "Runde abgeschlossen";
          el.revealLabel.className =
            "text-sm uppercase tracking-[0.4em] text-slate-400";
          el.revealText.textContent = "Diskussion starten";
          el.revealHint.textContent = state.word
            ? `Gesuchter Begriff war: ${state.word.word}.`
            : "";
          updateControls();
        }

        function resetRoundState() {
          state.order = [];
          state.currentIndex = -1;
          state.imposter = null;
          state.word = null;
          state.revealed = false;
          state.active = false;
          state.phase = "setup";
          setStatus(
            "Noch keine Runde aktiv.",
            "Sobald du startest, erscheint hier die Reihenfolge."
          );
          hideCard();
        }

        function hideCard() {
          el.revealLabel.textContent = "Bereit?";
          el.revealLabel.className =
            "text-sm uppercase tracking-[0.4em] text-slate-500";
          el.revealText.textContent = 'Tippe auf "Anzeigen".';
          el.revealHint.textContent = "Nur die aktuelle Person darf schauen.";
        }

        function setStatus(title, subtitle) {
          el.statusTitle.textContent = title;
          el.statusSubtitle.textContent = subtitle;
        }

        function updateControls() {
          const canStart = state.players.length >= 3;
          el.startGame.disabled = !canStart;
          el.showCard.disabled =
            !state.active || state.revealed || state.currentIndex === -1;
          el.nextPlayer.disabled = !state.active || !state.revealed;
          el.restartRound.disabled = !(
            state.active || state.phase === "discussion"
          );
          updateView();
        }

        function updateView() {
          const hasEnoughPlayers = state.players.length >= 3;
          const roundVisible = state.active || hasEnoughPlayers;
          el.roundSection.classList.toggle("hidden", !roundVisible);
          el.setupSection.classList.toggle("hidden", state.active);

          const showPhase = state.phase === "show" && state.active;
          const revealPhase = state.phase === "reveal" && state.active;

          el.showCard.classList.toggle("hidden", !showPhase);
          el.nextPlayer.classList.toggle("hidden", !revealPhase);

          if (state.active && state.currentIndex !== -1) {
            el.progressIndicator.textContent = `Spieler ${
              state.currentIndex + 1
            } von ${state.order.length}`;
            el.progressIndicator.classList.remove("hidden");
          } else {
            el.progressIndicator.classList.add("hidden");
          }

          el.orderNote.classList.toggle(
            "hidden",
            !(state.active || state.phase === "discussion")
          );
          el.restartRound.classList.toggle(
            "hidden",
            !(state.active || state.phase === "discussion")
          );
        }

        init();
      })();
    </script>
  </body>
</html>
